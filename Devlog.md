# 记录开发过程中出现的问题

1. 刚开始出现了循环登陆的问题，原因是在`identityServer`中添加了`Identity`的支持，但是登陆方式还是用的cookie的方式进行登陆所以登陆完成后向`IdentityServer`发起登陆验证的时候又验证到没有登陆所以又调整到登陆的`Action`。后来改用`Identity`的`SignInManager`就解决问题了。

2. 想要更自由的拓展`Identity`的数据库表结构，需要实现`IUserStore`接口并且注入到容器中。但是由于官方也并没有很详细的接口的实现帮助文档，所以得看`UserManager`的源码知道在源码里面如何使用`IUserStore`。

3. 其中`FindByNameAsync()`这个方法输入的是格式化后的名称，从`Identity`的源码中可以看到格式化是把用户名都转换成大写来实现。所以在该项目中用户表有两个名称字段，一个就是用户输入的名称，一个是格式化后用作搜索的名称。

4. 其中以Set开头的方法不需要直接访问数据库，在传递进来的实参上进行操作就好了。`UserManager`会在之后进行`Update`更新数据库。还有一点就是当数据库中没有找到用户时，返回值为null，不能够抛出异常。

5. 必须在访问https上的Endpoint
